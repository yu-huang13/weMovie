<% include layout.ejs %>

<% if(user) {%>
	<a href="/createMission" name="title">创建观影任务</a>
	
	<% missions.forEach(function(mission,index){ %>
		<% if(index%3 == 0){ %>
					<div class="row">
		<% } %>
		<div id="mission<%= index %>" class="col-sm-4">
			<h2>
				Movie: <a href="/m/<%= mission._id.toString() %>"><%= mission.videoName %></a>
			</h2>
			<h4>
				by: <a href="/u/<%= mission.creator %>"><%= mission.creator %></a>
			</h4>
			
			<form class="form-horizontal" method="post">
			<p id="vu<%= index %>" ><%= mission.vu %></p>
			<p id="beginTime<%= index %>" ><%= mission.beginTime %></p>
			<p id="duration<%= index %>" ><%= mission.duration %></p>
			<p id="member<%= index %>" ><%= mission.member %></p>
			<button id="mbutton<%= index %>" type="button" onclick="ModifyMission(<%= index %>)">修改</button>
			<button id="dbutton<%= index %>" type="button" onclick="DeleteMission(<%= index %>)">删除</button>
			</form>

		</div>
		<% if(index%3 == 2) {%>
			</div> <!-- end row -->
		<% } %>
	<% }) %>
	<% if(missions.length % 3 != 0) {%>
	</div>  <!-- end row -->
	<% } %>
<% } %>

<script>
function ModifyMission(id) {
	vu_id = "vu" + id;
	vu_value = document.getElementById(vu_id).innerHTML;
	$("p[id^='vu']").eq(id).replaceWith('<input type="text" value=\"' + vu_value + '\" class="input-xlarge" id=\"' + vu_id + '\" name="vu">');

	bt_id = "beginTime" + id;
	bt_value = document.getElementById(bt_id).innerHTML;
	$("p[id^='beginTime']").eq(id).replaceWith('<input type="text" value=\"' + bt_value + '\" class="input-xlarge" id=\"' + bt_id + '\" name="beginTime">');

	dt_id = "duration" + id;
	dt_value = document.getElementById(dt_id).innerHTML;
	$("p[id^='duration']").eq(id).replaceWith('<input type="text" value=\"' + dt_value + '\" class="input-xlarge" id=\"' + dt_id + '\" name="duration">');
	
	mm_id = "member" + id;
	mm_value = document.getElementById(mm_id).innerHTML;
	$("p[id^='member']").eq(id).replaceWith('<input type="text" value=\"' + mm_value + '\" class="input-xlarge" id=\"' + mm_id + '\" name="member">');

	/*mb_id = "mbutton" + id;
	$("button[id^='member']").eq(id).replaceWith('<input type="text" value=\"' + mm_value + '\" class="input-xlarge" id=\"' + mm_id + '\" name="member">');*/
}

function DeleteMission(id) {
	$("div[name^='mission']").eq(id).replaceWith('');
	window.location.assign("/");
}
</script>
